<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link href="styles/style.css" rel="stylesheet">
  </head>
  <body>
    <button type="button" onclick="actualiza()">actualiza</button>
    <div id="chart"> </div>
    <div id="explanation">
      <h1>Ejemplo de uso de la gráfica de Stacked Bars con Líneas</h1>
      El script en este archivo muesra la funcionalidad básica.
    </div>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-queue.v3.min.js"></script>
    <script src="components/stackedBars.js"></script>
    <script>
      var currentRegion = 0,
          allData;

      // Se inicializa la gráfica llamando stackedBarChart()
      // Cada opción se fija llamando al método correspondiente con
      // el valor como argumento.
      // Las opciones obligatorias son:
      // stackVariables (array) Los nombres de las variables para construir los stacks
      // displayName (string) La columna con los nombres para el eje x
      // id Un identificador único para bcada fila
      var bar = stackedBarChart()
          .width(600)
          .height(400)
          .margin({top: 40, right: 60, bottom: 60, left: 60})
          .stackVariables(["Pop with bachelor",
                           "Pop with grad"])
          .lineVariables(["Percentage bachelor", "Percentage grad"])
          .displayName("name")
          .barAxisLabel("Population")
          .lineAxisLabel("Percentage")
          .legend({title: 'IKOs', translateX: -70, translateY: 0,
                   itemsLine:["Percentage bachelor", "Percentage grad"],
                   itemsBar: ["Pop with bachelor","Pop with grad"]})
          .id("name");
          

      d3.csv("data/stacked_many_lines.csv",
             function(error, vars){
                 if (error) throw error;
                 // Parse data as numbers
                 data = [];
                 vars.forEach(function(d) {
                     data.push({
                         id: d["name"], 
                         name: d.name, // lowercase
                         region: d.region,
                         "Pop with bachelor":
                             +d["Pop with bachelor"],
                         "Pop with grad":
                         +d["Pop with grad"],
                         "Percentage bachelor":
                             +d["Percentage bachelor"],
                         "Percentage grad":
                             +d["Percentage grad"]
                     });
                 });
                 initialData = data.filter(function(d){
                     return d.region === "megalopolis"
                 });
                 // Con los datos leídos del csv (parseados como números)
                 // se llama a método data para unir los datos con la gráfica
                 bar.data(initialData); // bind data to chart object
                 // Con una selección sobre el contenedor de la gráfica,
                 // se llama al método call(bar) para dibujar la gráfica.
                 d3.select("#chart")
                     .call(bar); // Draw chart in selected div
             });
      function actualiza(){
          //currentRegion ++;
          newData = data.filter(function(el){
              return el.region == "Noreste";})
          // Para actualizar la gráfica, simplemente se llama a data() con
          // los nuevos datos.
          bar.data(newData);
      }
    </script>

  </body>
</html>
